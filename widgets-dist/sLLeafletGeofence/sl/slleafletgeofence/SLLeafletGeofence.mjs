import e,{useContext as t,useRef as n,useEffect as o,createElement as i}from"react";import c from"big.js";var r;!function(e){e[e.SetMapReady=0]="SetMapReady",e[e.SetMapName=1]="SetMapName",e[e.SetMarkers=2]="SetMarkers",e[e.SetGeoJSON=3]="SetGeoJSON",e[e.SetGeoJSONAction=4]="SetGeoJSONAction",e[e.SetGeofence=5]="SetGeofence",e[e.SetGeofenceAction=6]="SetGeofenceAction",e[e.SetGeofenceOutAction=7]="SetGeofenceOutAction",e[e.SetGeofencePositionAction=8]="SetGeofencePositionAction",e[e.SetGeofenceOptions=9]="SetGeofenceOptions",e[e.SetMarkerAction=10]="SetMarkerAction",e[e.SetMarkerDragAction=11]="SetMarkerDragAction"}(r||(r={}));const a=e=>e&&"available"===e.status;function u(u){const{state:l,dispatch:f}=t(mx.slmap.context),d=n([]),s=n(),G=n(),g=n(),v=n(),S=n(),p=()=>{var e,t;return null!==(t=null===(e=u.defaultRadius.value)||void 0===e?void 0:e.toNumber())&&void 0!==t?t:30},A=e=>{const t=e.map((e=>{var t,n,o,i;return u.id.get(e).value&&u.latitude.get(e).value&&u.longitude.get(e).value?{id:u.id.get(e).value.toString(),position:[parseFloat(u.latitude.get(e).value),parseFloat(u.longitude.get(e).value)],radius:u.radius&&null!==(n=null===(t=u.radius.get(e).value)||void 0===t?void 0:t.toNumber())&&void 0!==n?n:p(),defaultColor:u.defaultColor&&u.defaultColor.get(e)&&null!==(o=u.defaultColor.get(e).value)&&void 0!==o?o:"#264ae5",activeColor:u.activeColor&&u.activeColor.get(e)&&null!==(i=u.activeColor.get(e).value)&&void 0!==i?i:"#3cb33d",strokeOpacity:u.strokeOpacity&&u.strokeOpacity.get(e)?u.strokeOpacity.get(e):1,strokeWeight:u.strokeWeight&&u.strokeWeight.get(e)?u.strokeWeight.get(e):3,fillOpacity:u.fillOpacity&&u.fillOpacity.get(e)?u.fillOpacity.get(e):1}:void 0})).filter((e=>!!e));var n,o;n=t,o=d.current,JSON.stringify(n)!==JSON.stringify(o)&&(d.current=t,f(function(e){return{type:r.SetGeofence,payload:[...e]}}([...t])))},O=(e,t)=>{g.current&&(g.current.canExecute?a(v.current)&&a(S.current)?(v.current.setValue(e),S.current.setValue(new c(t.toFixed(2))),g.current.execute()):console.warn("Cannot set Geofence ID and Geofence distance attribute"):console.warn("Cannot execute Geofence IN event"))},m=e=>{s.current&&(s.current.canExecute?a(G.current)?(G.current.setValue(e),s.current.execute()):console.warn("Cannot set Geofence Out ID attribute"):console.warn("Cannot execute Geofence OUT event"))},C=(e,t)=>{u.onGeofenceCurrentPositionAction&&u.onGeofenceCurrentPositionLatitude&&u.onGeofenceCurrentPositionLongitude&&(u.onGeofenceCurrentPositionLatitude.setValue(e),u.onGeofenceCurrentPositionLongitude.setValue(t),u.onGeofenceCurrentPositionAction.execute())};return o((()=>{l.mapReady&&u.data.items&&A(u.data.items)}),[u.data.items,l.mapReady]),o((()=>{var e,t,n,o,i;f((i={enabled:null===(e=u.geofenceEnabled.value)||void 0===e||e,setView:null===(t=u.geofenceSetViewEnabled.value)||void 0===t||t,maximumAge:null!==(o=null===(n=u.maximumAge.value)||void 0===n?void 0:n.toNumber())&&void 0!==o?o:0},{type:r.SetGeofenceOptions,payload:i}))}),[u.maximumAge.value,u.geofenceEnabled.value,u.geofenceSetViewEnabled.value]),o((()=>{var e;g.current=u.onGeofenceAction,v.current=u.onGeofenceId,S.current=u.onGeofenceDistance,s.current=u.onGeofenceOutAction,G.current=u.onGeofenceOutId,u.onGeofenceAction&&u.onGeofenceId&&u.onGeofenceAction.canExecute&&!l.geofenceAction&&f((e=O,{type:r.SetGeofenceAction,payload:e})),u.onGeofenceOutAction&&u.onGeofenceOutId&&u.onGeofenceOutAction.canExecute&&!l.geofenceOutAction&&f(function(e){return{type:r.SetGeofenceOutAction,payload:e}}(m)),u.onGeofenceCurrentPositionAction&&u.onGeofenceCurrentPositionLatitude&&u.onGeofenceCurrentPositionLongitude&&u.onGeofenceCurrentPositionAction.canExecute&&!l.geofencePositionAction&&f(function(e){return{type:r.SetGeofencePositionAction,payload:e}}(C))}),[u.onGeofenceAction,u.onGeofenceId,u.onGeofenceOutAction,u.onGeofenceOutId,u.onGeofenceCurrentPositionAction,u.onGeofenceCurrentPositionLatitude,u.onGeofenceCurrentPositionLongitude]),i(e.Fragment,null)}export{u as SLLeafletGeofence};
